---
interface Props {
  title: string;
  description?: string;
}

const { title, description = "A community-sourced board for UX roles at companies building products that actually matter. Free, open source, and always will be." } = Astro.props;
const canonicalUrl = new URL(Astro.url.pathname, 'https://health.designjobs.cv');
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#FFF7E6" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#111113" media="(prefers-color-scheme: dark)" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="format-detection" content="telephone=no" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalUrl.href} />
    <meta property="og:site_name" content="designjobs" />
    <meta property="og:image" content="https://health.designjobs.cv/og-image.png" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="https://health.designjobs.cv/og-image.png" />

    <link rel="canonical" href={canonicalUrl.href} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate" type="application/rss+xml" title="designjobs Healthcare Jobs Feed" href="/rss.xml" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <!-- Be Vietnam Pro is loaded via Google Fonts above -->
    <title>{title}</title>
    <script is:inline>
      document.documentElement.classList.add('js-ready');
      const t = localStorage.getItem('theme');
      if (t === 'dark' || (!t && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    </script>
  </head>
  <body class="bg-warm-50 dark:bg-surface-page text-slate-900 dark:text-slate-100 font-sans antialiased min-h-screen flex flex-col transition-colors">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-[100] focus:bg-brand-500 focus:text-white focus:px-4 focus:py-2 focus:rounded-lg focus:text-sm focus:font-medium">
      Skip to main content
    </a>
    <slot />

    <!-- Dark Mode Color Tuner -->
    <div id="color-panel" style="position:fixed;bottom:20px;right:20px;z-index:9999;background:#1a1a2e;color:#e0e0e0;border-radius:16px;padding:20px;width:300px;font-family:system-ui,sans-serif;box-shadow:0 8px 32px rgba(0,0,0,0.4);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.08);font-size:13px;max-height:80vh;overflow-y:auto;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <span style="font-weight:700;font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:#888;">Dark Mode Colors</span>
        <div style="display:flex;gap:8px;align-items:center;">
          <button id="color-panel-copy" style="background:none;border:none;color:#5872FA;cursor:pointer;font-size:11px;font-weight:600;" title="Copy values">Copy</button>
          <button id="color-panel-toggle" style="background:none;border:none;color:#666;cursor:pointer;font-size:16px;padding:0;line-height:1;" title="Minimize">−</button>
        </div>
      </div>
      <div id="color-panel-body"></div>
    </div>

    <script is:inline>
    (function() {
      var groups = [
        {
          label: 'Page Background',
          controls: [
            { id: 'page-bg', label: 'Background', initial: '#131416', target: 'body', prop: 'backgroundColor' },
          ]
        },
        {
          label: 'Header / Footer',
          controls: [
            { id: 'header-bg', label: 'Header', initial: '#0d0f12', target: 'header[role="banner"]', prop: 'backgroundColor' },
            { id: 'footer-bg', label: 'Footer', initial: '#0d0f12', target: 'footer[role="contentinfo"]', prop: 'backgroundColor' },
          ]
        },
        {
          label: 'Cards / Sections',
          controls: [
            { id: 'card-bg', label: 'Cards', initial: '#161718', targets: '.dark\\:bg-surface-card, [class*="bg-white"]', prop: 'backgroundColor', darkOnly: true },
            { id: 'card-hover', label: 'Card Hover', initial: '#090d20', info: '(job row hover)' },
            { id: 'newsletter-bg', label: 'Newsletter', initial: '#161718', target: '#newsletter', prop: 'backgroundColor' },
            { id: 'jobs-list-bg', label: 'Jobs List', initial: '#161718', target: '[role="list"][aria-label="Job listings"]', prop: 'backgroundColor' },
          ]
        },
      ];

      var body = document.getElementById('color-panel-body');
      var toggle = document.getElementById('color-panel-toggle');
      var copyBtn = document.getElementById('color-panel-copy');
      var panel = document.getElementById('color-panel');
      var minimized = false;
      var values = {};

      toggle.addEventListener('click', function() {
        minimized = !minimized;
        body.style.display = minimized ? 'none' : 'block';
        toggle.textContent = minimized ? '+' : '−';
        panel.style.width = minimized ? 'auto' : '300px';
      });

      // Only show in dark mode
      function checkDark() {
        var isDark = document.documentElement.classList.contains('dark');
        panel.style.display = isDark ? 'block' : 'block'; // show always for now, colors apply in dark
      }
      checkDark();
      new MutationObserver(checkDark).observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });

      function applyColor(ctrl, color) {
        values[ctrl.id] = color;
        if (ctrl.target) {
          var els = document.querySelectorAll(ctrl.target);
          els.forEach(function(el) { el.style.setProperty(ctrl.prop || 'background-color', color, 'important'); });
        }
        if (ctrl.targets) {
          var els = document.querySelectorAll(ctrl.targets);
          els.forEach(function(el) { el.style.setProperty(ctrl.prop || 'background-color', color, 'important'); });
        }
        // Special: card hover needs CSS variable
        if (ctrl.id === 'card-hover') {
          document.documentElement.style.setProperty('--color-card-hover', color);
        }
      }

      groups.forEach(function(group) {
        var section = document.createElement('div');
        section.style.cssText = 'margin-bottom:14px;';
        var title = document.createElement('div');
        title.style.cssText = 'font-size:10px;text-transform:uppercase;letter-spacing:1px;color:#555;margin-bottom:8px;';
        title.textContent = group.label;
        section.appendChild(title);

        group.controls.forEach(function(ctrl) {
          values[ctrl.id] = ctrl.initial;
          var row = document.createElement('div');
          row.style.cssText = 'display:flex;align-items:center;gap:10px;margin-bottom:6px;';

          var colorInput = document.createElement('input');
          colorInput.type = 'color';
          colorInput.value = ctrl.initial;
          colorInput.style.cssText = 'width:32px;height:24px;border:1px solid rgba(255,255,255,0.1);border-radius:6px;background:transparent;cursor:pointer;padding:0;';

          var label = document.createElement('span');
          label.style.cssText = 'flex:1;font-size:12px;color:#aaa;';
          label.textContent = ctrl.label + (ctrl.info ? ' ' + ctrl.info : '');

          var hex = document.createElement('input');
          hex.type = 'text';
          hex.value = ctrl.initial;
          hex.style.cssText = 'width:72px;font-size:11px;font-family:monospace;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:6px;padding:3px 6px;color:#ccc;text-align:center;';

          colorInput.addEventListener('input', function() {
            hex.value = colorInput.value;
            applyColor(ctrl, colorInput.value);
          });
          hex.addEventListener('change', function() {
            if (/^#[0-9a-fA-F]{6}$/.test(hex.value)) {
              colorInput.value = hex.value;
              applyColor(ctrl, hex.value);
            }
          });

          row.appendChild(colorInput);
          row.appendChild(label);
          row.appendChild(hex);
          section.appendChild(row);
        });

        body.appendChild(section);
      });

      // Copy button — outputs tailwind config format
      copyBtn.addEventListener('click', function() {
        var output = 'Dark mode colors:\\n';
        output += 'page: \\'' + values['page-bg'] + '\\',\\n';
        output += 'header: \\'' + values['header-bg'] + '\\',\\n';
        output += 'footer: \\'' + values['footer-bg'] + '\\',\\n';
        output += 'card: \\'' + values['card-bg'] + '\\',\\n';
        output += 'card-hover: \\'' + values['card-hover'] + '\\',\\n';
        output += 'newsletter: \\'' + values['newsletter-bg'] + '\\',\\n';
        output += 'jobs-list: \\'' + values['jobs-list-bg'] + '\\',\\n';
        navigator.clipboard.writeText(output.replace(/\\n/g, '\\n'));
        copyBtn.textContent = 'Copied!';
        setTimeout(function() { copyBtn.textContent = 'Copy'; }, 1500);
      });
    })();
    </script>
  </body>
</html>

<style is:global>
  @tailwind base;
  @tailwind components;
  @tailwind utilities;

  /* Custom easing curves (stronger than defaults) */
  :root {
    --ease-out-quart: cubic-bezier(0.165, 0.84, 0.44, 1);
    --ease-out-cubic: cubic-bezier(0.215, 0.61, 0.355, 1);
  }

  /* Dark mode toggle transition (View Transitions API) */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 350ms;
    animation-timing-function: ease-in-out;
  }
  ::view-transition-old(root) {
    animation-name: fade-out;
  }
  ::view-transition-new(root) {
    animation-name: fade-in;
  }
  @keyframes fade-out { from { opacity: 1; } to { opacity: 0; } }
  @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

  /* Button press feedback */
  a[class*="rounded-full"][class*="bg-sapphire"],
  button[type="submit"] {
    transition: background-color 150ms ease, transform 100ms var(--ease-out-cubic);
  }
  a[class*="rounded-full"][class*="bg-sapphire"]:active,
  button[type="submit"]:active {
    transform: scale(0.97);
  }

  /* Stagger fade-in animations */
  /* fadeUp — for hero/decorative elements (has scale + translateY) */
  @keyframes fadeUp {
    from {
      opacity: 0;
      transform: translateY(12px) scale(0.98);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* fadeIn — for functional UI (opacity + subtle translateY only, no scale) */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-up {
    opacity: 0;
    animation: fadeUp 0.25s var(--ease-out-quart) forwards;
    will-change: transform, opacity;
  }

  .animate-fade-in {
    opacity: 0;
    animation: fadeIn 0.2s var(--ease-out-cubic) forwards;
    will-change: opacity, transform;
  }

  .stagger-1 { animation-delay: 0ms; }
  .stagger-2 { animation-delay: 60ms; }
  .stagger-3 { animation-delay: 120ms; }
  .stagger-4 { animation-delay: 180ms; }
  .stagger-5 { animation-delay: 240ms; }
  .stagger-6 { animation-delay: 300ms; }

  /* Intersection observer reveal — hidden by default, JS adds .visible */
  .js-ready .reveal {
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 150ms var(--ease-out-quart), transform 150ms var(--ease-out-quart);
    will-change: transform, opacity;
  }
  .js-ready .reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }
  /* List items: opacity only, no vertical shift — snappier for repeated elements */
  .js-ready .reveal.reveal-fade {
    transform: none;
    transition: opacity 120ms var(--ease-out-cubic);
  }
  .js-ready .reveal.reveal-fade.visible {
    transform: none;
  }

  /* Accessibility: respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .animate-fade-up,
    .animate-fade-in {
      animation: none;
      opacity: 1;
    }
    .js-ready .reveal,
    .js-ready .reveal.reveal-fade {
      transition: none;
      opacity: 1;
      transform: none;
    }
  }
</style>

<script is:inline>
  // Intersection observer for scroll-triggered reveals (js-ready added in <head>)
  document.addEventListener('DOMContentLoaded', function() {
    var reveals = document.querySelectorAll('.reveal');
    if (!reveals.length) return;

    if (!('IntersectionObserver' in window)) {
      // Fallback: just show everything
      reveals.forEach(function(el) { el.classList.add('visible'); });
      return;
    }

    var observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          var el = entry.target;
          var delay = el.dataset.delay || '0';
          el.style.transitionDelay = delay + 'ms';
          el.classList.add('visible');
          observer.unobserve(el);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });

    reveals.forEach(function(el) { observer.observe(el); });
  });
</script>
