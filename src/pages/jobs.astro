---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import JobCard from '../components/JobCard.astro';
import Newsletter from '../components/Newsletter.astro';
import jobs from '../data/jobs.json';

const levels = [...new Set(jobs.map(j => j.level))];
const locationTypes = [...new Set(jobs.map(j => j.locationType))];
---

<Layout title="All Jobs ‚Äî designwith.care">
  <Header />

  <section class="max-w-6xl mx-auto px-6 pt-12 pb-6">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">All jobs</h1>
    <p class="text-gray-500">{jobs.length} healthcare UX roles from companies that care</p>
  </section>

  <!-- Filters -->
  <section class="max-w-6xl mx-auto px-6 pb-8">
    <div class="flex flex-wrap gap-3" id="filters">
      <button
        class="filter-btn active px-4 py-2 rounded-full text-sm font-medium border transition-all"
        data-filter="all"
      >
        All
      </button>
      {levels.map(level => (
        <button
          class="filter-btn px-4 py-2 rounded-full text-sm font-medium border transition-all"
          data-filter={`level:${level}`}
        >
          {level}
        </button>
      ))}
      <span class="border-l border-gray-200 mx-1"></span>
      {locationTypes.map(lt => (
        <button
          class="filter-btn px-4 py-2 rounded-full text-sm font-medium border transition-all"
          data-filter={`location:${lt}`}
        >
          {lt === 'Remote' ? 'üåç ' : lt === 'Hybrid' ? 'üè¢ ' : 'üìç '}{lt}
        </button>
      ))}
    </div>
  </section>

  <!-- Jobs List -->
  <section class="max-w-6xl mx-auto px-6 pb-20">
    <div class="grid gap-3" id="jobs-list">
      {jobs.map(job => (
        <div
          class="job-item"
          data-level={job.level}
          data-location-type={job.locationType}
        >
          <JobCard {...job} />
        </div>
      ))}
    </div>
    <p id="no-results" class="text-center text-gray-400 py-12 hidden">
      No jobs match this filter. Try a different one!
    </p>
  </section>

  <!-- Newsletter -->
  <section class="max-w-3xl mx-auto px-6 pb-20">
    <Newsletter />
  </section>

  <Footer />
</Layout>

<style>
  .filter-btn {
    border-color: #e5e7eb;
    color: #6b7280;
    background: white;
  }
  .filter-btn:hover {
    border-color: #D4E0F5;
    color: #0F52BA;
  }
  .filter-btn.active {
    background: #0F52BA;
    border-color: #0F52BA;
    color: white;
  }
</style>

<script>
  const buttons = document.querySelectorAll('.filter-btn');
  const items = document.querySelectorAll('.job-item');
  const noResults = document.getElementById('no-results');

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      buttons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      const filter = btn.getAttribute('data-filter') || 'all';
      let visible = 0;

      items.forEach(item => {
        const el = item as HTMLElement;
        if (filter === 'all') {
          el.style.display = '';
          visible++;
        } else if (filter.startsWith('level:')) {
          const match = el.dataset.level === filter.split(':')[1];
          el.style.display = match ? '' : 'none';
          if (match) visible++;
        } else if (filter.startsWith('location:')) {
          const match = el.dataset.locationType === filter.split(':')[1];
          el.style.display = match ? '' : 'none';
          if (match) visible++;
        }
      });

      if (noResults) {
        noResults.style.display = visible === 0 ? '' : 'none';
        noResults.classList.toggle('hidden', visible > 0);
      }
    });
  });
</script>
